# 21 | Chrome开发者工具：利用网络面板做性能分析

- 浏览器页面模块开始，浏览器所有功能服务页面，Chrome开发者工具-- 我们调试页面的核心

- 聚焦点：页面源头网络数据接收

##  网络面板

- 组成区域： 控制器， 过滤器， 抓图信息， 时间线，详细列表和下载信息

1. 控制器 
   - 红色圆点抓包开始或暂停
   - 全局搜索
   - Disable cache，禁止从Cache中加载资源， 开启cache会影响网络性能测试结果
   - Online 模拟2G/3G功能
2. 过滤器
   - 过滤不同类型的文件
3. 抓图信息
   - 抓图信息，分析用户等待页面加载所看到的内容，勾选面板 Capture screenshots
4. 事件线
   - 用于展示HTTP、HTTPS、WebSocket加载的状态和时间的关系，直观感受页面加载过程
5. 详细列表，
   - 记录每个资源从发起请求到完成请求中间所有状态，和最终请求完成的数据信息，诊断网络问题
6. 下载信息概要
   - 重点关注DOMContentLoaded(页面构建好DOM，构建使用的HTML、CSS、JS文件已经下载完成)、Load事件(加载资源)



### 详细列表

- 列表属性(Name资源名, Status状态码, Type资源类型, Initator链接, size大小, Time时间)
- 详细信息(横栏Headers请求头，Preview数据预览，Response响应体，Timing时间线)
  - 请求头中往下分别是: 请求行、响应行、响应头、请求头
- 单个资源的时间线(Timing)
  - 重定向(Redirect)--> (发起请求) --> 查找缓存 --> DNS --> 建立TCP --> 发出请求(Request) --> 回复请求头(Request Header) --> (是否重定向，分叉点) --> 回复数据
  - Queue 排队时间 Started 开始时间 (资源优先级，CSS、HTML、JS优先级最高，图片音频排后)
  - 一个域名最多维护6个TCP连接，所以超出的请求就处于排队状态
  - 网络进程为数据分配磁盘空间， 新http请求需要短暂的等待磁盘分配结束
  - Stalled(停滞时间) 发起连接钱导致连接过程被推迟
  - 代理服务器(额外增加 Proxy Negotiation)
  - 到达Inital Connection/SSL阶段。与服务器建立连接，包括建立TCP连接花费时间， HTTPS协议还会有一个额外的SSL握手时间，通常协商加密信息
  - 网络进程请求数据并发送给网络，为Request sent阶段， 通常这个阶段只需把浏览器缓冲区数据发送出去就结束，不需要判断是否收到(<1ms)
  - 等待接收服务器第一个字节的数据(Waiting (TTFB)) 称为"第一字节时间"，是反应服务端响应速度的重要指标
  - 接收到第一字节后， 进入陆续接收完成数据阶段， 为Content Download阶段

## 优化时间线上耗时项

1. 排队时间过久，大概率因为浏览器为每个域名最多维护六个连接导致的，所以可以让一个站点下的资源存放到多个域名上，域名越多，支持的连接数也*6，称为`域名分片技术` 同时也可以将站点升级为HTTP2，因为HTTP2没有对维护TCP连接限制。
2. 第一字节时间过久 一为服务器生成页面数据时间过久(SSR页面直出)，传统后端渲染(如JAVA等都是拿到数据后将数据回填到模板然后进行模板渲染，如果数据拿到慢那肯定影响模板渲染时间) 二是网络问题，服务器带宽较低，不同运营商之间的访问速度不快 三是发送请求头上带了过多的用户信息(Cookie如果对cookie每一项数据都要进行处理，处理时长拉大) 处理方案： 提高服务器处理速度，增加缓存，网络问题 通过CDN缓存静态文件，Cookie问题发送请求时尽量减少不必要的Cookie信息
3. Content Download时间过久，字节数过多，可以减少文件大小，压缩，去掉源码不必要的注释



## summary

- Chrome开发者工具10个基础面板信息，结合之前的网络请求流程重点分析时间线上各个指标的含义，对异常进行分析给出优化方案
- 其他优化方案: gzip 前端模块化，webpack进行压缩打包， es module 优化 ，缓存方面 协商缓存 CDN对静态文件和第三方Js库加载 代码压缩(CSS 代码行压缩) nginx动态代理做分发